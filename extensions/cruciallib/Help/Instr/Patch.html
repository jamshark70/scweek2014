<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="1038.36">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #9d200d}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Lucida Grande'; min-height: 15.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #2e2312}
p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0b1c76}
p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Lucida Grande'}
p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #295d0e}
p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0012af}
p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; min-height: 17.0px}
p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #3d3d1b; min-height: 12.0px}
p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #7c210d}
p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #7c210d; min-height: 12.0px}
p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #00139d}
p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 15.0px Helvetica}
p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #3b3b3b}
p.p20 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #4d4d4d}
p.p21 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Arial}
p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Arial; min-height: 14.0px}
p.p23 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000ee}
span.s1 {color: #0023d9}
span.s2 {color: #0012af}
span.s3 {color: #295d0e}
span.s4 {color: #000000}
span.s5 {color: #4d4d4d}
span.s6 {text-decoration: underline ; color: #001fc5}
span.s7 {color: #00139d}
span.s8 {color: #29480e}
span.s9 {color: #001499}
span.s10 {font: 12.0px Helvetica}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><b>Patch</b></p>
<p class="p2"><br></p>
<p class="p3"><b>a Player</b></p>
<p class="p2"><br></p>
<p class="p3">An <a href="SC://Instr"><span class="s1">Instr</span></a> (Instrument) is a function that has a unique name attached to it.</p>
<p class="p3">A Patch specifies an Instr by name and specifies inputs that will be passed to the Instr function when it is actually played.<span class="Apple-converted-space">  </span>A Patch is the player that actually plays an Instr's sound function.</p>
<p class="p4"><br></p>
<p class="p3"><b>Patch(instr,args)</b></p>
<p class="p2"><br></p>
<p class="p3"><b>instr</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>an instr name</p>
<p class="p3"><span class="Apple-tab-span">	</span>a function</p>
<p class="p3"><span class="Apple-tab-span">	</span>an Instr object</p>
<p class="p3"><b>args - an array of<span class="Apple-converted-space"> </span></b></p>
<p class="p3"><span class="Apple-tab-span">	</span>floats</p>
<p class="p3"><span class="Apple-tab-span">	</span>players of any type</p>
<p class="p3"><span class="Apple-tab-span">	</span>many other types of objects</p>
<p class="p3"><span class="Apple-tab-span">	</span>It all depends what the instr function accepts.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>or a dictionary/event expressing args by name as:<span class="Apple-converted-space">  </span>(argName: value, ... )</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p6">// given a simple instrument</p>
<p class="p5"><span class="s2">Instr</span>(<span class="s3">\Pulse</span>,{ <span class="s2">arg</span> freq=440.0,width=0.5,mul=0.1;</p>
<p class="p2"><br></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">Pulse</span>.ar( freq, width, mul )</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p6">// a patch specifies inputs (arguments) to that instrument</p>
<p class="p5">p = <span class="s2">Patch</span>( <span class="s3">\Pulse</span>, [</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>300,</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0.2,</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0.1</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>]);</p>
<p class="p2"><br></p>
<p class="p6">//the default server will be booted, the SynthDef written and loaded</p>
<p class="p5">p.play;</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p5">p.stop;</p>
<p class="p2"><br></p>
<p class="p6">// command-. will also stop all sounds</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>Instr can be specified as<span class="Apple-converted-space"> </span></b></p>
<p class="p7"><br></p>
<p class="p3">by the Instr name (see <a href="SC://Instr"><span class="s1">Instr</span></a>)</p>
<p class="p8">// the Instr stores itself when created</p>
<p class="p5">(</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span></span>// this can be kept in a separate file</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">Instr</span>(<span class="s3">\bubbles</span>, { <span class="s2">arg</span> amp=1.0;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">var</span> f, zout;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>f = <span class="s2">LFSaw</span>.kr(0.4, 0, 24, <span class="s2">LFSaw</span>.kr([8,7.23], 0, 3, 80)).midicps;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>zout = <span class="s2">CombN</span>.ar(<span class="s2">SinOsc</span>.ar(f, 0, 0.04), 0.2, 0.2, 4);</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>zout * amp</p>
<p class="p5"><span class="Apple-tab-span">	</span>});</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span></span>// the patch retrieves it</p>
<p class="p5"><span class="Apple-tab-span">	</span>p = <span class="s2">Patch</span>(<span class="s3">\bubbles</span>,[0.4] );</p>
<p class="p5"><span class="Apple-tab-span">	</span>p.gui</p>
<p class="p5">)</p>
<p class="p3">a Function</p>
<p class="p5">(</p>
<p class="p5"><span class="Apple-tab-span">	</span>p = <span class="s2">Patch</span>({ <span class="s2">arg</span> freq=100,amp=1.0;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">SinOsc</span>.ar([freq,freq + 30],0,amp)</p>
<p class="p5"><span class="Apple-tab-span">	</span>},[</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>500,</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0.3</p>
<p class="p5"><span class="Apple-tab-span">	</span>]);</p>
<p class="p5"><span class="Apple-tab-span">	</span>p.gui</p>
<p class="p9">)</p>
<p class="p10">or directly as an Instr object</p>
<p class="p5">(</p>
<p class="p5"><span class="Apple-tab-span">	</span>i = <span class="s2">Instr</span>(<span class="s5">"help-Patch"</span>,{ <span class="s2">arg</span> freq=100,amp=1.0;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s2">SinOsc</span>.ar([freq,freq + 30],0,amp)</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>});</p>
<p class="p5"><span class="Apple-tab-span">	</span>p = <span class="s2">Patch</span>(i,[ 500,<span class="Apple-tab-span">	</span>0.3 ]);</p>
<p class="p5"><span class="Apple-tab-span">	</span>p.gui</p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>The args</b></p>
<p class="p2"><br></p>
<p class="p3">The args may be whatever the instr function is willing to accept.</p>
<p class="p3">These may be simple floats,</p>
<p class="p3">Envelopes,</p>
<p class="p3">Audio rate Players</p>
<p class="p3">Control rate Players</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">(</p>
<p class="p5"><span class="s2">Instr</span>(<span class="s3">\bubbles</span>, { <span class="s2">arg</span> amp=1.0;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">var</span> f, zout;</p>
<p class="p5"><span class="Apple-tab-span">	</span>f = <span class="s2">LFSaw</span>.kr(0.4, 0, 24, <span class="s2">LFSaw</span>.kr([8,7.23], 0, 3, 80)).midicps;</p>
<p class="p5"><span class="Apple-tab-span">	</span>zout = <span class="s2">CombN</span>.ar(<span class="s2">SinOsc</span>.ar(f, 0, 0.04), 0.2, 0.2, 4);</p>
<p class="p5"><span class="Apple-tab-span">	</span>zout * amp</p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p5"><span class="s2">Instr</span>(<span class="s3">\rlpf</span>,{ <span class="s2">arg</span> audio=0,freq=500,rq=0.1;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">RLPF</span>.ar(audio, freq, rq)</p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p5">p = <span class="s2">Patch</span>(<span class="s3">\rlpf</span>,[</p>
<p class="p11"><span class="s4"><span class="Apple-tab-span">	</span>q = </span><span class="s2">Patch</span><span class="s4">(</span>\bubbles<span class="s4">)</span></p>
<p class="p5">]);</p>
<p class="p2"><br></p>
<p class="p5">p.gui</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p3">Each argument has a <a href="SC://Spec"><span class="s6">Spec</span></a>.<span class="Apple-converted-space">  </span>See <a href="SC://Instr"><span class="s6">Instr</span></a> for how these specs are determined.</p>
<p class="p4"><br></p>
<p class="p3">An argument may be nil.<span class="Apple-converted-space">  </span>For a nil argument, Patch will ask the spec to create a suitable defaultControl.</p>
<p class="p7"><br></p>
<p class="p10">ControlSpec :<span class="Apple-converted-space">  </span>KrNumberEditor</p>
<p class="p10">StaticSpec<span class="Apple-converted-space">    </span>:<span class="Apple-converted-space">  </span>NumberEditor<span class="Apple-converted-space">  </span>(for quantities or max delay times etc.)</p>
<p class="p10"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>a static spec is a non-modulateable control</p>
<p class="p10">EnvSpec <span class="Apple-converted-space">      </span>: EnvEditor</p>
<p class="p10">SampleSpec : Sample</p>
<p class="p7"><br></p>
<p class="p2"><br></p>
<p class="p3">The instrument may specify default values in the arg names of its function:</p>
<p class="p5">(</p>
<p class="p5"><span class="s2">Instr</span>(<span class="s3">\bubbles</span>, { <span class="s2">arg</span> speed = 0.4, amp=0.4;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">var</span> f, zout;</p>
<p class="p5"><span class="Apple-tab-span">	</span>f = <span class="s2">LFSaw</span>.kr(speed, 0, 24, <span class="s2">LFSaw</span>.kr([8,7.23], 0, 3, 80)).midicps;</p>
<p class="p5"><span class="Apple-tab-span">	</span>zout = <span class="s2">CombN</span>.ar(<span class="s2">SinOsc</span>.ar(f, 0, 0.04), 0.2, 0.2, 4);</p>
<p class="p5"><span class="Apple-tab-span">	</span>zout * amp</p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p6">// the patch specifies the actual values to be used</p>
<p class="p11"><span class="s4">p = </span><span class="s2">Patch</span><span class="s4">(</span>\bubbles<span class="s4">,<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="Apple-tab-span">	</span>[<span class="Apple-converted-space"> </span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0.01 // speed is a fixed float of 0.01</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// but amp is not specified, so the default 0.4 from the Instr function is used</p>
<p class="p5"><span class="Apple-tab-span">	</span>]);</p>
<p class="p2"><br></p>
<p class="p6">// but notice that it is a KrNumberEditor that was created, and it inits to the default 0.4</p>
<p class="p6">// from the instr function</p>
<p class="p5">p.gui;</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p3">If you wanted to build your patch with a KrNumberEditor (a slider) defaulted to 0.01 for the speed:</p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p11"><span class="s2">Patch</span><span class="s4">(</span>\bubbles<span class="s4">,</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>[</p>
<p class="p12"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>KrNumberEditor<span class="s4">(0.01,</span><span class="s3">\speed</span><span class="s4">)</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>]).gui</p>
<p class="p5">)<span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3">Args may also be supplied using a dictionary/event expressing args by name as:<span class="Apple-converted-space">  </span>(argName: value, ... )</p>
<p class="p2"><br></p>
<p class="p5">Patch({ arg freq,amp;</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>SinOsc.ar(freq,amp)</p>
<p class="p5">},(</p>
<p class="p5"><span class="Apple-tab-span">	</span>amp: 0.4</p>
<p class="p5">)).gui</p>
<p class="p2"><br></p>
<p class="p3">This is useful for Instr with long arg lists and helps to avoid errors.</p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3"><b>Automatic Input Creation</b></p>
<p class="p13"><br></p>
<p class="p10">For any nil arguments, a default control will be created. <span class="Apple-converted-space"> </span></p>
<p class="p7"><br></p>
<p class="p10">This gives the impression that Patch is "an automatic gui for an Instr / SynthDef". <span class="Apple-converted-space"> </span></p>
<p class="p7"><br></p>
<p class="p10">If you do not supply arguments, it will make default ones, simple ones, <b>but the real power of Patch is to supply functions with complex and varied inputs</b>.<span class="Apple-converted-space">  </span>Sitting there with 5 sliders on a 1 dimensional Instrument isn't really the height of synthesis.</p>
<p class="p7"><br></p>
<p class="p10">I recommend experimenting with factory methods to create your patches, supplying them with inputs useful for what you are working on.</p>
<p class="p7"><br></p>
<p class="p10">eg. If you use a certain physical controller or wacom :</p>
<p class="p2"><br></p>
<p class="p5">buildPatch<span class="Apple-converted-space">  </span>= { <span class="s2">arg</span> instrName;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">var</span> i;</p>
<p class="p5"><span class="Apple-tab-span">	</span>i = <span class="s2">Instr</span>.at(instrName);</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">Patch</span>(instrName,[</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>{ i.specAt(0).map( <span class="s2">JoyAxis</span>.kr(0,1,axis:5) ) },</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>{ i.specAt(1).map( <span class="s2">JoyAxis</span>.kr(0,1,axis:5) ) },</p>
<p class="p5"><span class="Apple-tab-span">	</span>])</p>
<p class="p5">};</p>
<p class="p6">// this creates a Patch</p>
<p class="p5">buildPatch.value( <span class="s3">\boingboing</span> );</p>
<p class="p7"><br></p>
<p class="p3">You could even interrogate the instr to see which inputs might make good candidates for your JoyAxis.</p>
<p class="p4"><br></p>
<p class="p3">Remember, Instr are not just for audio functions, so you can even keep your factories themselves in Instrument libraries:</p>
<p class="p4"><br></p>
<p class="p5"><span class="s2">Instr</span>(<span class="s3">\joysticker</span>,[ <span class="s2">arg</span> instrName;</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">var</span> i;</p>
<p class="p5"><span class="Apple-tab-span">	</span>i = <span class="s2">Instr</span>.at(instrName);</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">Patch</span>(instrName,[</p>
<p class="p5"><span class="Apple-tab-span">	</span>  { i.specAt(0).map( <span class="s2">JoyAxis</span>.kr(0,1,axis:5) ) },</p>
<p class="p5"><span class="Apple-tab-span">	</span>  { i.specAt(1).map( <span class="s2">JoyAxis</span>.kr(0,1,axis:5) ) },</p>
<p class="p5"><span class="Apple-tab-span">	</span>])</p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5">patch = <span class="s2">Instr</span>(<span class="s3">\joysticker</span>).value( <span class="s3">\simple</span> );</p>
<p class="p4"><br></p>
<p class="p3">You have just used an Instr function to create and return a Patch.</p>
<p class="p3">This Instr is not used for audio, its just used to build and return a Patch</p>
<p class="p7"><br></p>
<p class="p10">You could choose different controllers for different common inputs,</p>
<p class="p10">you can query the argument name and the spec.</p>
<p class="p10">Keep files in databases,<span class="Apple-converted-space">  </span>load other Patches or soundfiles from disk.</p>
<p class="p10">You could flip coins and choose from soundfiles, audio in, other saved<span class="Apple-converted-space"> </span></p>
<p class="p10">patches or randomly chosen net radio feeds.</p>
<p class="p7"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>Fixed Arguments</b></p>
<p class="p4"><br></p>
<p class="p3">Floats and other scalar values including Envelopes, are transparently dealt with by Patch.<span class="Apple-converted-space">  </span>These items are passed to the Instr function, but not to the SynthDef or the Synth.<span class="Apple-converted-space">  </span>They are not modulateable.</p>
<p class="p14"><br></p>
<p class="p5">(</p>
<p class="p6">// fixing arguments</p>
<p class="p2"><br></p>
<p class="p5"><span class="s2">Instr</span>([<span class="s3">\jmcExamples</span>,<span class="s3">'moto-rev'</span>],{ <span class="s2">arg</span> lfo=0.2,freq=1000,rq=0.1;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">RLPF</span>.ar(<span class="s2">LFPulse</span>.ar(<span class="s2">SinOsc</span>.kr(lfo, 0, 10, 21), [0,0.1], 0.1), freq, rq).clip2(0.4);</p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p11"><span class="s4">q = </span><span class="s2">Patch</span><span class="s4">([</span>\jmcExamples<span class="s4">,</span>'moto-rev'<span class="s4">],[</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>0.2</p>
<p class="p5">]);</p>
<p class="p2"><br></p>
<p class="p5">q.gui;</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">You can design Instr to take parameters that are used only in the building of the SynthDef. This can be used to select from different kinds of filters or to .</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5"><span class="s2">Instr</span>(<span class="s3">\upOrDown</span>, {<span class="s2">arg</span> upDown=0;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">var</span> line;</p>
<p class="p5"><span class="Apple-tab-span">	</span>if (upDown&gt;0,</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>{line = </span><span class="s2">Line</span><span class="s4">.kr(1,0,5)}, </span>// upDown&gt;0 ==&gt; pitch goes up</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>{line = </span><span class="s2">Line</span><span class="s4">.kr(0,1,5)}  </span>// upDown 0 or less ==&gt; pitch goes down</p>
<p class="p5"><span class="Apple-tab-span">	</span>);</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">SinOsc</span>.ar(440*line,0,0.2);</p>
<p class="p5">},[</p>
<p class="p12"><span class="s4"><span class="Apple-tab-span">	</span></span>StaticIntegerSpec<span class="s4">(0,1)</span></p>
<p class="p5">]);</p>
<p class="p2"><br></p>
<p class="p5"><span class="s2">Patch</span>(<span class="s3">\upOrDown</span>, [ 0]).play</p>
<p class="p2"><br></p>
<p class="p3">The upDown param acts as a switch between different synth def architectures.<span class="Apple-converted-space">  </span>If your Instr library is well designed you can acheive very sophisticated sound structures with automatic optimizations and code reuse.</p>
<p class="p4"><br></p>
<p class="p3">Note that the Patch would assume upDown to be a modulatable control input (with a default of 0.0) without the StaticIntegerSpec making it clear that its a static integer.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>Busses and Groups</b></p>
<p class="p5">(</p>
<p class="p2"><br></p>
<p class="p5">s.boot;</p>
<p class="p2"><br></p>
<p class="p5">a = <span class="s2">Group</span>.new;</p>
<p class="p2"><br></p>
<p class="p5">b = <span class="s2">Group</span>.after(a);</p>
<p class="p2"><br></p>
<p class="p5">c = <span class="s2">Bus</span>.audio(s,1);</p>
<p class="p2"><br></p>
<p class="p5">p=<span class="s2">Patch</span>({ <span class="s2">arg</span> in,ffreq;</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span></span>// the Bus is passed in as In.ar(bus.index,bus.numChannels)</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">LPF</span>.ar(in,ffreq)</p>
<p class="p5">},[</p>
<p class="p5"><span class="Apple-tab-span">	</span>c,</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">KrNumberEditor</span>(3000,[200,8000,<span class="s3">\exp</span>])</p>
<p class="p5">]).play(group: b);</p>
<p class="p2"><br></p>
<p class="p6">// play something onto this bus in a group before that of the filter</p>
<p class="p5">y = <span class="s2">Patch</span>({<span class="Apple-tab-span">	</span><span class="s2">Saw</span>.ar(400) * 0.1<span class="Apple-converted-space">  </span>}).play(group: a, bus: c );</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5">z = <span class="s2">Patch</span>({<span class="Apple-tab-span">	</span><span class="s2">Saw</span>.ar(500) * 0.1<span class="Apple-converted-space">  </span>}).play(group: a, bus: c );</p>
<p class="p2"><br></p>
<p class="p5">z.bus</p>
<p class="p5">z.synth</p>
<p class="p5">z.group</p>
<p class="p5">z.server</p>
<p class="p2"><br></p>
<p class="p5">z.stop;</p>
<p class="p2"><br></p>
<p class="p5">y.stop;</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p6">// z and y are now stopped by p is still playing</p>
<p class="p2"><br></p>
<p class="p6">// c is a Bus object</p>
<p class="p5">c</p>
<p class="p6">// play c ontto a main audio output</p>
<p class="p5">c.play</p>
<p class="p2"><br></p>
<p class="p6">//use command-. to stop all</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p5">s.boot;</p>
<p class="p2"><br></p>
<p class="p5">a = <span class="s2">Group</span>.new;</p>
<p class="p2"><br></p>
<p class="p5">b = <span class="s2">Group</span>.after(a);</p>
<p class="p2"><br></p>
<p class="p6">// no index, not yet allocated</p>
<p class="p5">c = <span class="s2">Bus</span>(<span class="s3">\audio</span>,<span class="s2">nil</span>,2);</p>
<p class="p2"><br></p>
<p class="p5">y = <span class="s2">Patch</span>({ <span class="s2">arg</span> in,ffreq;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">LPF</span>.ar(in,ffreq)</p>
<p class="p5">},[</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span>c, </span>// a proxy, the bus is yet to be allocated</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">KrNumberEditor</span>(3000,[200,8000,<span class="s3">\exp</span>])</p>
<p class="p5">]).play(group: b);</p>
<p class="p2"><br></p>
<p class="p6">// now that the patch has played, the bus allocated itself</p>
<p class="p5">c.insp</p>
<p class="p2"><br></p>
<p class="p6">// play onto this bus in a group before that of the filter</p>
<p class="p5">z = <span class="s2">Patch</span>({<span class="Apple-tab-span">	</span><span class="s2">Saw</span>.ar([400,401]) * 0.1<span class="Apple-converted-space">  </span>}).play(group: a, bus: c )</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>Automagic setter for the inputs of the Patch</b></p>
<p class="p3"><b>Sending controllers to the Patch while its playing</b></p>
<p class="p4"><br></p>
<p class="p2"><br></p>
<p class="p5">p = <span class="s7">Patch</span>({ <span class="s7">arg</span> freq=440; <span class="s7">SinOsc</span>.ar( freq ) });</p>
<p class="p15">// with no args supplied, a KrNumberEditor was made as input for \freq</p>
<p class="p5">p.args.dump;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5">p.play</p>
<p class="p2"><br></p>
<p class="p16"><br></p>
<p class="p15">// each arg name automagically becomes an attribute of the patch object</p>
<p class="p5">p.freq</p>
<p class="p2"><br></p>
<p class="p15">// set its value</p>
<p class="p5">p.freq.value = 300</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p15">// look for the input for the 'freq' arg</p>
<p class="p15">// and sends it the .set(500) message if it responds to that</p>
<p class="p5">p.set(<span class="s8">\freq</span>, 500)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p13"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">Quite apart from Patch, you can use a spec to map a signal from a 0..1 range to the range of the spec :</p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p5"><span class="s7">var</span> spec;</p>
<p class="p5">spec = [ 100,18000,<span class="s8">\exp</span>].asSpec;</p>
<p class="p2"><br></p>
<p class="p5">{</p>
<p class="p17"><span class="s4"><span class="Apple-tab-span">	</span></span>SinOsc<span class="s4">.ar(</span></p>
<p class="p15"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>// creates a BinaryOpUGen</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>spec.map(<span class="Apple-converted-space">  </span><span class="s7">SinOsc</span>.kr(0.1).range(0,1) ).dump</p>
<p class="p5"><span class="Apple-tab-span">	</span>)</p>
<p class="p5">}.play</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">you can also do that with a Patch, supplying the resulting function as an input to the patch:</p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p5"><span class="s2">var</span> spec;</p>
<p class="p5">spec = [ 100,18000,<span class="s3">\exp</span>].asSpec;</p>
<p class="p2"><br></p>
<p class="p5"><span class="s2">Patch</span>({ <span class="s2">arg</span> freq;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">SinOsc</span>.ar(freq)</p>
<p class="p5">},[</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span></span>// creates a BinaryOpFunction</p>
<p class="p5"><span class="Apple-converted-space">    </span>spec.map( { <span class="s2">SinOsc</span>.kr(0.1).range(0,1) } ).dump</p>
<p class="p5">]).play</p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p13"><br></p>
<p class="p3">A Patch is subclass of AbstractPlayer which is a subclass of AbstractFunction.</p>
<p class="p4"><br></p>
<p class="p3">Because a Player IS A FUNCTION, a Spec may also be used to map another player's output and then use that as an input to a patch :</p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p5"><span class="s2">var</span> spec;</p>
<p class="p5">spec = [ 100,18000,<span class="s3">\exp</span>].asSpec;</p>
<p class="p2"><br></p>
<p class="p5"><span class="s2">Patch</span>({ <span class="s2">arg</span> freq;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">SinOsc</span>.ar(freq)</p>
<p class="p5">},[</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span></span>// a BinaryOpFunction</p>
<p class="p5"><span class="Apple-converted-space">    </span>spec.map( <span class="s2">Patch</span>({ <span class="s2">SinOsc</span>.kr(0.1).range(0,1) }) ).debug</p>
<p class="p5">]).play</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p4"><br></p>
<p class="p3">spec.map is taking the player</p>
<p class="p3">and creating a BinaryOpFunction out of it.</p>
<p class="p4"><br></p>
<p class="p3">if you do math on functions you get another function.</p>
<p class="p2"><br></p>
<p class="p5">f = { 3 } * { 4 };</p>
<p class="p2"><br></p>
<p class="p5">f.value</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">the simplest example is:</p>
<p class="p2"><br></p>
<p class="p5">(<span class="s2">Patch</span>({ <span class="s2">SinOsc</span>.ar(440) }) * 0.1).play</p>
<p class="p2"><br></p>
<p class="p3">where the output of the Patch is multiplied by 0.1, reducing the amplitude.</p>
<p class="p3">Internal optimization in this case results in using a PlayerAmp</p>
<p class="p2"><br></p>
<p class="p6">// true binary op players not yet implemented :(</p>
<p class="p5">(<span class="s2">Patch</span>({<span class="s2">SinOsc</span>.ar(440) }) % 0.4).play</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>Spawning</b></p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p2"><br></p>
<p class="p5">a = <span class="s2">Patch</span>({</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">SinOsc</span>.ar(800,0.0)</p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5">c = <span class="s2">Bus</span>.audio;</p>
<p class="p5">a.play(bus: c);</p>
<p class="p6">// a is now playing on bus c, which we can't hear</p>
<p class="p2"><br></p>
<p class="p6">// patch b will listen to buss c and play one enveloped grain</p>
<p class="p5">b = <span class="s2">Patch</span>({ <span class="s2">arg</span> tone;</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">var</span> gate;</p>
<p class="p5"><span class="Apple-tab-span">	</span>gate = <span class="s2">Trig1</span>.kr(1.0,0.25);</p>
<p class="p5"><span class="Apple-tab-span">	</span>tone = <span class="s2">In</span>.ar(tone,1);</p>
<p class="p5"><span class="Apple-tab-span">	</span>tone * <span class="s2">EnvGen</span>.kr(<span class="s2">Env</span>([0,1,0],[0.05,0.05],<span class="s3">\welch</span>,1),gate,doneAction: 2)</p>
<p class="p5">},[</p>
<p class="p5"><span class="Apple-tab-span">	</span>c.index</p>
<p class="p5">]);</p>
<p class="p2"><br></p>
<p class="p5">b.prepareForPlay(s);</p>
<p class="p2"><br></p>
<p class="p6">// play one grain</p>
<p class="p5">b.spawn(atTime: 0.1);</p>
<p class="p2"><br></p>
<p class="p6">// play 100 grains</p>
<p class="p12">Routine<span class="s4">({</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>1.0.wait;</p>
<p class="p5"><span class="Apple-tab-span">	</span>100.do({</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>b.spawn(atTime: 0.1);</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>0.25.wait</p>
<p class="p5"><span class="Apple-tab-span">	</span>})</p>
<p class="p12"><span class="s4">}).play(</span>SystemClock<span class="s4">)</span></p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p18"><b>Extra capabilities</b></p>
<p class="p4"><br></p>
<p class="p3">Because the Patch manages the creation of the SynthDef and also manages the Synth that is created at the time of play, it is possible to do some tricks that make client-server communication a bit easier. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">Keep in mind that when the sc lang code that is inside a SynthDef or an Instr is run when the the SynthDef or InstrSynthDef is compiled.<span class="Apple-converted-space">  </span>Its compiled into bytecode that is then sent to the server but then when the synth itself runs there is no sc language.<span class="Apple-converted-space">  </span>There are no functions or 'if' statements.</p>
<p class="p4"><br></p>
<p class="p3">So once you have that concept clear in your head, here's how to violate it.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>UGen:onTrig(function,value)</b></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>trigger.onTrig({ <span class="s9">|time,value|</span></p>
<p class="p19"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>"did trig"<span class="s4">.postln</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>})</p>
<p class="p2"><br></p>
<p class="p3">On receiving a trigger (a non-positive to positive transition) evaluate the function IN THE CLIENT LANGUAGE.<span class="Apple-converted-space">  </span>A value may also be passed in which will be polled and passed to the function.</p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p12">Patch<span class="s4">({ </span>|freq=200|</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">var</span> out;</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>out = <span class="s2">LFSaw</span>.ar(freq);</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>(<span class="s2">Dust</span>.kr(0.3)).onTrig({ <span class="s2">|time,value|</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[<span class="s5">"dusty"</span>,time,value].postln</p>
<p class="p6"><span class="s4"><span class="Apple-tab-span">	</span>},out); </span>// this value will be polled anytime the trig goes</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>out * 0.1<span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p5">}).play</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p12"><span class="s4">p = </span>Patch<span class="s4">({ </span>|freq=200|</p>
<p class="p2"><br></p>
<p class="p5"><span class="Apple-tab-span">	</span>(freq &gt;= 300).onTrig({</p>
<p class="p20"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>"GREATER !"<span class="s4">.postln</span></p>
<p class="p5"><span class="Apple-tab-span">	</span>});</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">LFSaw</span>.ar(freq) * 0.1</p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p5">p.play</p>
<p class="p2"><br></p>
<p class="p5">)</p>
<p class="p2"><br></p>
<p class="p5">p.freq.value = 400</p>
<p class="p2"><br></p>
<p class="p5">p.freq.value = 200</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p5">(</p>
<p class="p2"><br></p>
<p class="p12"><span class="s4">p = </span>Patch<span class="s4">({ </span>|freq=200|</p>
<p class="p2"><br></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">var</span> lfo;</p>
<p class="p5"><span class="Apple-tab-span">	</span>lfo = <span class="s2">LFSaw</span>.kr(0.2);</p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">Dust</span>.kr(2.0).onTrig({ <span class="s2">|time,value|</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[time,value].postln</p>
<p class="p5"><span class="Apple-tab-span">	</span>},lfo);</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p5"><span class="Apple-tab-span">	</span><span class="s2">LFSaw</span>.ar(freq)</p>
<p class="p5">});</p>
<p class="p2"><br></p>
<p class="p5">p.play</p>
<p class="p2"><br></p>
<p class="p21">)</p>
<p class="p22"><br></p>
<p class="p22"><br></p>
<p class="p21">You could also spawn more synths.</p>
<p class="p22"><br></p>
<p class="p22"><br></p>
<p class="p21">What is happening is that a ClientOnTrigResponder is added to the InstrSynthDef's stepchildren.<span class="Apple-converted-space">  </span>When a Patch plays it also plays its children (the inputs to the patch) and its stepchildren.<span class="Apple-converted-space">  </span>The ClientOnTrigResponder adds an OSCpathResponder when the synth starts and removes it when the synth stops. <span class="Apple-converted-space"> </span></p>
<p class="p22"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p23"><span class="s4">see also [<a href="SC://InstrGateSpawner"><span class="s10">InstrGateSpawner</span></a>]</span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
</body>
</html>
