<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="824.41">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0000bf}
span.s1 {font: 18.0px Helvetica}
span.s2 {font: 9.0px Monaco; text-decoration: underline}
span.s3 {font: 9.0px Monaco}
span.s4 {color: #000000}
span.s5 {color: #0000bf}
span.s6 {color: #007300}
span.s7 {color: #606060}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>MarkovSet<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></span><b>first order markov set</b></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">instance creation:</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>*new(args, updateSeeds)</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>args</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>a list of arrays that each represent<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>one node in the set:</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>[element, [next_elements], [weigths]]</b></p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>next_elements</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>the next node is searched by simple equality.</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if nil, this is a terminator node</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>weights</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>the array is normalized.</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if weigths is nil, equal weight is used</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if args is nil, the set is created and may be trained by the<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>other methods.</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>updateSeeds</b></p>
<p class="p3"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>if set to true, each element is always added to the seeds.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>*fill(n, stream)<span class="Apple-converted-space"> </span></b><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>n</b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>number of items to read</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>stream</b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>a function or stream that returns items to read</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3">instance methods</p>
<p class="p2"><b></b><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>read(prev, next)</b></p>
<p class="p3"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>read a pair of values</p>
<p class="p2"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b></p>
<p class="p3"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>put(element, next_elements, weights)</b></p>
<p class="p3"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>insert a node. any old node is overwritten</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>remove(prev, next)</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>remove a pair of values</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>next(for)</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>return a next item for the arg value.</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if arg is nil, choose from seeds.</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>parse(stream, length)</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>read <i>length</i> items into the set from the stream</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="s2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span><b>asStream</b></p>
<p class="p3"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>returns a stream that creates a markov chain</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>spy</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>decrepated: use Pspy (see examples)</p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p2"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></p>
<p class="p5">// examples:</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">// direct node definition</p>
<p class="p6">(</p>
<p class="p7"><span class="s4">m = </span>MarkovSet<span class="s4">([</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[100, [120, 130]],</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[120, [100, 1900]],</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[130, <span class="s5">nil</span>],</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>]);</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">8.do { m.next(100).postln };</p>
<p class="p6">8.do { m.next(120).postln };</p>
<p class="p6">8.do { m.next(130).postln };</p>
<p class="p4"><br></p>
<p class="p5">// training by a stream</p>
<p class="p4"><br></p>
<p class="p6">m = <span class="s5">MarkovSet</span>.fill(100, <span class="s5">Pseq</span>([1, 2, 3, 4, <span class="s5">Prand</span>([5, 55, 555])], <span class="s5">inf</span>).asStream);</p>
<p class="p6">8.do { m.next(1).postln };</p>
<p class="p6">8.do { m.next(4).postln };</p>
<p class="p6">8.do { m.next(55).postln };</p>
<p class="p4"><br></p>
<p class="p5">// training bit by bit</p>
<p class="p4"><br></p>
<p class="p6">m = <span class="s5">MarkovSet</span>.new;</p>
<p class="p6">m.read(<span class="s6">\x</span>, <span class="s6">\y</span>);</p>
<p class="p6">m.read(<span class="s6">\x</span>, <span class="s6">\z</span>);</p>
<p class="p6">m.read(<span class="s6">\z</span>, <span class="s6">\abcde</span>);</p>
<p class="p6">m.read(<span class="s6">\y</span>, <span class="s5">nil</span>);</p>
<p class="p4"><br></p>
<p class="p6">8.do { m.next(<span class="s6">\x</span>).postln };</p>
<p class="p6">8.do { m.next(<span class="s6">\y</span>).postln };</p>
<p class="p6">8.do { m.next(<span class="s6">\z</span>).postln };</p>
<p class="p4"><br></p>
<p class="p6">m.read(<span class="s6">\y</span>, <span class="s6">\mmmm</span>);</p>
<p class="p5"><span class="s4">8.do { m.next(</span><span class="s6">\y</span><span class="s4">).postln }; </span>// now it sometimes terminates</p>
<p class="p4"><br></p>
<p class="p6">m.remove(<span class="s6">\y</span>, <span class="s6">\mmmm</span>);</p>
<p class="p6">8.do { m.next(<span class="s6">\y</span>).postln };</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">//////////<span class="Apple-converted-space">  </span>creating streams</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p7"><span class="s4">m = </span>MarkovSet<span class="s4">([</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[100, [120, 130]],</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[120, [100, 1900]],</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[130, <span class="s5">[100]</span>],</p>
<p class="p7"><span class="s4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[1900, </span>[1000, 2000, 3000]<span class="s4">],</span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>]);</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">m.makeSeeds;</p>
<p class="p6">x = m.asStream;</p>
<p class="p6">32.do { x.next.postln };</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">// spy out a stream to feed it in</p>
<p class="p4"><br></p>
<p class="p6">z = <span class="s5">Pseq</span>([100, 200, 300, <span class="s5">Prand</span>([1.2, 1.4, 1.5])],<span class="s5">inf</span>).asStream;</p>
<p class="p6">z = <span class="s5">Pspy</span>(m, z).asStream;</p>
<p class="p4"><br></p>
<p class="p6">32.do { x.next.postln };</p>
<p class="p5"><span class="s4">15.do { z.next } </span>// add some more elements from z</p>
<p class="p6">32.do { x.next.postln };</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p5">// event streams</p>
<p class="p6">(</p>
<p class="p6"><span class="s5">SynthDef</span>(<span class="s7">"mark"</span>, { <span class="s5">arg</span> out, freq, sustain=1, amp=0.1, pan;</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s5">var</span> env, u=1;</p>
<p class="p6"><span class="Apple-tab-span">	</span>env = <span class="s5">EnvGen</span>.kr(<span class="s5">Env</span>.perc(0.03, sustain, 5), 1, doneAction:2);</p>
<p class="p6"><span class="Apple-tab-span">	</span>3.do { <span class="s5">var</span> d; d = exprand(0.01, 1); u = <span class="s5">SinOsc</span>.ar(d * 300, u, rrand(0.1, 0.4) * d, 1) };</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s5">Out</span>.ar(out, <span class="s5">Pan2</span>.ar(<span class="s5">SinOsc</span>.ar(u + 1 * freq, 0, amp * env), pan));</p>
<p class="p4"><br></p>
<p class="p6">}).store;</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">(</p>
<p class="p6">a = <span class="s5">Pbind</span>(</p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s6">\freq</span>, <span class="s5">Pshuf</span>([203, 490, 231, 764, 234], <span class="s5">inf</span>),<span class="Apple-converted-space"> </span></p>
<p class="p6"><span class="Apple-tab-span">	</span><span class="s6">\dur</span>, <span class="s5">Pshuf</span>([0.5, 0.5, 1.0, 0.25, 0.125, 0.5], <span class="s5">inf</span>)</p>
<p class="p6">);</p>
<p class="p6">m = <span class="s5">MarkovSet</span>.fill(20, <span class="s5">Pevent</span>(a, <span class="s5">Event</span>.default).asStream);</p>
<p class="p6">)</p>
<p class="p4"><br></p>
<p class="p6">m.dict.keysValuesDo { <span class="s5">|key, val|</span> postf(<span class="s7">"key: %\t\tvalue: %\n"</span>, key, val) }; <span class="s7">""</span></p>
<p class="p4"><br></p>
<p class="p5">// compare:</p>
<p class="p6">b = <span class="s5">Pchain</span>(<span class="s5">Pfsm2</span>(m), (instrument: <span class="s6">\mark</span>));</p>
<p class="p6">c = <span class="s5">Pchain</span>(a, (instrument: <span class="s6">\mark</span>));</p>
<p class="p4"><br></p>
<p class="p6"><span class="s5">Ppar</span>([b, c]).play;</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
</body>
</html>
